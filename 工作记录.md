# 工作记录

1. bingo登录和跨天新增challenge_prize字段，传挑战关奖励

2. 挑战关开启，会传挑战关数据，challenge_board和challenge_history，有挑战关断线数据，会传挑战关断线数据challenge_disconnection

3. 普通bingo的collect_bingo_ball协议开启挑战关传open_challenge_level字段，以及challenge_board和challenge_history字段，挑战关的collect_bingo_ball协议在触发打火机会返回挑战关对应的字段

4. roll_bingo_ball、collect_bingo_ball、roll_wild_bingo_ball添加challenge请求，1为挑战关，不传或0为普通bingo

5. 挑战关通关在roll_bingo_ball协议下面的last_bingo中传challenge_is_bingo字段

6. 普通盘面type=4为挑战关（1为宝箱，2为碎片，3为纸飞机）

7. 挑战关盘面6、8、16、18为火箭位置，第一个数字方别为101、102、103和104，打火机在其它格子，type分别为1、2、3、4，对应相应的火箭，火箭的最后一个数字为火箭被点次数，默认为0，最高为2

## 21025

discount_coupon返回字段格式

```json
{u'discount_coupon': {u'store_discount_coupon_cid': 1, u'store_discount_coupon_list': [{u'end_time': 1624626603, u'level': 2, u'type': 1},
{u'end_time': 1624627086, u'level': 2, u'type': 1},
{u'end_time': 1624627240, u'level': 2, u'type': 1}]}}
```

store_discount_coupon_cid

1. 开启21025 benefit会新增一个discount_coupon_benefit，活动期间只能获取一次，商店任意购买获得discount_coupon，在collect_store返回discout_coupon_result字段，discount_coupon_result字段下面传store_discount_coupon_cid和store_discount_coupon_list

2. 如果有未过期的代金券，登录和跨天的store_info字段下面会有discount_coupon字段

3. 新增激活代金券的协议activate_discount_coupon，同activate_coupon，传入cid和type，返回store_info

4. 激活代金券后商店的store_info下面的sales_list字段的price会更新为新的价格，旧的价格在old_price下面

## b级活动三选一

* 新增prize_type字段，在登录和跨天返回，默认为空字符串，选择奖励后改完选择的奖励类型（atw, byd, stamp)，在完成一轮后置为空字符串
* 新增set_b_system_prize_type协议，传b_system_type（cooking, archer等b级活动字段）和prize_type（atw、byd和stamp）字段，初始化奖励后传回相关b级活动的数据
* 在未选择奖励的时，cooking字段下的final_prize、index_prize和extra_prize不传，传total_final_prize和total_index_prize、total_extra_prize和total_dash_prize(根据开启的dash活动更新奖励)
* 玩家的排行榜名次从login数据获取，在last_b_ranking字段下面
* 新增collect_b_system_ranking_prize协议，传玩家的奖励选择情况，用choose_prize_list，[0, 0, 0, 0, 0, 0, 0, 0]，每个代表一个奖励选项，不选为0， 数组第一个数对应第一档奖励，选择有三个，1为atw，2为byd，3为stamp，b_ranking_reward字段，格式通之前login，奖励通过inbox发放

## bingo

1.能量电池占球吗
2.获取的能量电池有水印吗

## 代金账户

1. 登录或跨天传frenzy_cash字段，返回当前frenzy cash数量
2. 消耗frenzy cash购买商品需要用consume_frenzy_cash协议，请求传item_id，协议返回值同new_pay协议返回值，额外返回一个frenzy_cash字段，返回消耗后的frenzy cash总数量
3. 消耗后传collect_store字段收取商店奖励，与付费购买相同
4. 通用奖励配置为frenzy_cash_point: num，num为配置数量，收奖返回值为frenzy_cash:num
   num为frenzy总数量

## jackpot again改版

1. 转盘数据为[10, 50, 100, 500, 1000, 5000]
2. benefit字段为jackpot_wheel_benefit
3. collect_store协议返回值，字段下面有wheel_index（0~5），为本次购买转盘的指针，total_win，limit_times为当前最大倍率
4. 中jackpot奖励后batch_spin协议下面返回jackpot_wheel字段，包含total_win和limit_times

## B级奖励商店

1. login和跨天返回b_store_manager字段，字段下面有b_store(当前b_store数量)，b_store_buy_times(限制购买商品的购买次数，由商品id和购买次数组成)
2. 通用奖励配置为b_store_point: 10
3. 通用收奖返回值为b_store: 100,放回值为用户当前b_store数量
4. consume_b_store_point传入购买的商店id，用b_store_id字段，购买成功后返回通用收奖返回值和b_store_manager

## super saver

1. super saver字段下面有两个字段：mission_list和active_mission_idx(默认-1)
2. 新增active_super_saver_mission协议，传入激活的任务index(从0开始)，返回super saver字段
3. 原super_saver_mission_collect协议不激活任务，返回字段super_saver格式同1
4. 购买后如果当前没有激活的super saver，会自动激活当前购买的super saver

## 5*3

* 0
		0. collect_solitaire
		1. collect_daily_bonus, inbox发小游戏也会有
		2. collect_level_up_party
		3. batch_spin或collect_coins
		4. collect_bc_mission

* 1
	1. mission_pass加经验的返回值里面
	2. batch_spin
	3. batch_spin或collect_coins
	4. atw通用收奖返回值，atw新手引导
	5. collect_mission

* 2
	1. batch_spin或collect_coins
	2. 加byd箱子，没返回值
	3. new_stamps同级
	4. collect_genie_game_plus
	5. batch_spin或collect_coins

## bingo挑战关
1. 初始位置为[101, 5, 1]
2. 获取新球位置有改变会返回new_pos和old_pos，以及line_map(同上一版)，有个小区别是球到底部不会传new_pos，只有old_pos和line_map

## b级排行榜

1. b choice过期无数据，之前b season为排行榜赛季，能否正常领奖励
2. 二选一选非排行榜，是否会降级
3. 二选一选排行榜，是否会正常发奖

## dash
journey:

* 15008:
  - target 50, 35, 25, 20
  - 消耗token数量
* 15009:
  - target 100, 80, 50, 40
  - 获取多少金币
* 15010:
  - target 700, 500, 400, 300
  - 走多少步

rocket：

* 11008
  - 40, 30, 20, 15
  - 消耗token数量
* 11009
  - 400, 320, 240, 160
  - 步数
* 11010
  - 10, 8, 6, 4
  - 完成一关/一轮

archer：

* 17007
  - 16, 12, 10, 8
  - 玩几次
* 17008
  - 50, 40, 25, 20
  - 获得多少金币
* 17009
  - 25, 20, 12, 10
  - 获得多少徽章

bingo:

* 14009
  - 50, 35, 25, 20
  - roll球数量
* 14010
  - 100, 80, 50, 40
  - 获得多少金币
* 14011
  - 30, 24, 20, 15
  - 完成几张卡

blast：

* 10009

- 50, 35, 25, 20
- pick次数

* 10010
  - 50, 40, 20, 15
  - 从箱子获得多少金币
* 10011
  - 25, 18, 12, 8
  - 完成多少次level

cooking:

* 16007
  - 30, 25, 20, 10
  - 购买材料次数
* 16008
  - 30, 25, 20, 10
  - 完成菜品次数
* 16009
  - 10, 8, 6, 4
  - 完成多少次level

gof:

* 18006
  - 40, 30, 20, 15
  - 消耗多少token
* 18007
  - 100, 80, 50, 40
  - 获取多少金币
* 18008
  - 10, 8, 6, 4
  - 完成多少次level

mow:

* 12007
  - 40, 30, 25, 15
  - 消耗token数量
* 12008
  - 120, 90, 75, 60
  - 获取多少金币
* 12009
  - 10, 8, 6, 5
  - 完成多少次level

## TOWER改版

login返回值branch_type字段，默认为0

roll_tower_step
新增has_branch字段，返回值有这个字段，表示玩家到达岔路，这时玩家会在岔路口停下，需要发送select_tower_branch_type协议，协议需要传入branch_type字段，值为0和1，表示玩家选择的路径，选完后发送collect_tower_step协议

## GOF

登录传special_wheel字段，目前special wheel还有几步触发
type = 17
index 0~5
index是转盘的结果
- 地图中随机添加一个1级大炮

- 随机一个大炮等级提升1级
- 金币（关卡内每次中到后都会提升数额）
- 地图中随机添加一个2级大炮
- 随机一个大炮等级提升至最高级
- 第二货币（关卡内每次中到后都会提升数额）
   0, 1, 3, 4有select_pos, 表示选的地图位置
   2有coins字段，5有chips字段

## pick小游戏

- 改为inbox发奖，208为smoking hot 209为lucky 88

- inbox收奖后需发enter_theme协议，字段同之前直接触发

- inbox收取奖励后未玩下线，登录会传has_luck_88:1或has_smoking_hot:1

- pick_select_small_theme协议，传type字段，里面传play或inbox字段，协议无返回值

- pick未发pick_select_small_theme协议断线，login协议的blast字段下会返回{'mini_theme': 2001}或{'mini_theme': 2003}


## atw换赛季

1. login的atw字段在s8新增atw_bag_list字段，返回玩家目前的atw_bag个类型数量
2. 通用atw收奖字段返回{'atw': {'delta_bag': [0, 0, 0, 10, 0]}}字段
3. 新增open_atw_bag协议，传type(1-5)，返回'atw': {'bag_info': {}, 'atw_bag_list': []}
4. 新增open_all_atw_bag协议，返回'atw': {'bags_list': [], 'atw_bag_list':[]}

## gof改版

1. 地图新增42(随机添加一个1级大炮)、43(随机添加一个2级大炮)、44(随机一个大炮升1级)、45(随机一个大炮升2级)，gof_spin返回字段为`{'type': 18, 'select_pos': **, 'index': 42}`，无法升级或添加大炮会没有select_pos字段，用coins字段代替
2. 特殊奖励依然为type=17，返回字段为`{'type': 17, 'pos': **, 'coins': $$}`

## lucky vault(礼物盒)

1. 有保险箱和prop bank两种功能
2. 保险箱通过spin到big win及以上获取，prop bank在获取a级道具的时候会存入
3. 保险箱共4个，每次能选一个开，或者用第二货币直接开
4. prop bank只能用第二货币开（价格随奖励上涨）

## pick

1. pick_frenzy_pick协议返回值修改，如果触发钥匙，会有额外的'key_type'字段
   `[u'pick_frenzy_pick', {'last_pick': {'pick_item': [9, 15], 'picked_index': 1}, 'token': 394}]`
2. 新增pick_collect_pick协议，收取奖励并返回blast字段及收取宝箱的add_chest_list字段和触发钥匙开宝箱的open_chest字段
3. blast新增disconnection字段，返回pick_frenzy_pick协议后的断线数据，同pick_frenzy_pick协议返回字段last_pick字段下的数据
4. 新增blast_chest_key购买项，2.99开金宝箱，1.99开银宝箱，0.99开铜宝箱，开启blast是login返回，在`['store_info']['blast']['chest_key_list']`字段下，new_pay协议需要传chest_index字段，指定开哪个宝箱（同第二货币），之后collect_store收取宝箱奖励，返回字段除了通用的购买返回外，还好返回open_chest和blast字段，逻辑同第二货币开宝箱

## journey

1. roll_journey_step新增boss_total_blood字段，返回当前boss最大血量
2. collect_journey_win字段下新增total_round_prize，返回4个轮次奖励
3. journey新增boss_reward字段

## mp打折

| type | ooc | free_player_flag | mp_last_purchase | qualificalion |
| ---- | --- | ---------------- | ---------------- | ------------- |
| 1    | 0   | 0                | 0                | 1             |
| 2    | 1   | 0                | 0                | 2             |
| 3    | 1   | 1                | 0                | 2             |
| 4    | 1   | 1                | 1                | 2             |

## cooking

1. 特殊关新增一关，在第3关和第4关之间，level_prize由5关改为6关
2. index=3为特殊关，特殊关在login会在cooking字段下额外返回special_level_cur_score，special_level_end_ts和special_level_target_score字段，分别表示当前分数，额外奖励到期时间，目标分数，在collect_cooking_map协议收取第3关奖励时也会返回这3个字段
3. 限时奖励special_level_limit_prize会一直传

## MP

宝箱用chest_avg_bet作基准，换赛季更新，如果大于property avg bet，维持，记日志

每级宝箱金币固定

## BYD换赛季

1. BYD_END_SEASON添加旧赛季结束时间
2. 修改math下byd_config.py的get_period和get_byd_manual函数的时间

## python获取字典占用字节数

```python
from __future__ import print_function
from sys import getsizeof, stderr
from itertools import chain
from collections import deque
try:
    from reprlib import repr
except ImportError:
    pass
 
def total_size(o, handlers={}, verbose=False):
    """ Returns the approximate memory footprint an object and all of its contents.
    Automatically finds the contents of the following builtin containers and
    their subclasses.tuple, list, deque, dict, set and frozenset.
    To search other containers, add handlers to iterate over their contents:
        handlers = {SomeContainerClass: iter,
                    OtherContainerClass: OtherContainerClass.get_elements}
    """
    dict_handler = lambda d: chain.from_iterable(d.items())
    all_handlers = {tuple: iter,
                    list: iter,
                    deque: iter,
                    dict: dict_handler,
                    set: iter,
                    frozenset: iter,
                   }
    all_handlers.update(handlers)     # user handlers take precedence
    seen = set()                      # track which object id's have already been seen
    default_size = getsizeof(0) 
    def sizeof(o):
        if id(o) in seen.     # do not double count the same object
            return 0
        seen.add(id(o))
        s = getsizeof(o, default_size) 
		if verbose:
            print(s, type(o), repr(o), file=stderr) 
        for typ, handler in all_handlers.items():
            if isinstance(o, typ):
                s += sum(map(sizeof, handler(o)))
                break
        return s 
    return sizeof(o)
```

## archer卖鱼日志

* cmd=6 清空
* cmd=5 发送卖鱼协议
* cmd=4 收奖

## 20094 texas party

1. login返回texas_party_status字段，包括collected_list(奖励领取情况)，prize_list(奖励列表，只有login获取跨天传)，special_card_collected(卡片奖励是否领取)字段，special_card_list(卡片积攒情况)，speical_card_prize，free_spin_times，以及disconnection(断线字段)，disconnection字段下有win_idx字段，代表抽取的奖励序号，如抽中卡片，会返回special_card字段
2. 新增texas_free_spin协议，发送协议抽取免费的一次，返回texas_party_status字段
3. 新增collect_texas_party_prize协议，收取断线数据的奖励，返回texas_party_status字段及texas——prize字段
4. 购买相关信息在store_info->texas_party字段下，在collect_store字段下返回texas_party_status字段，之后发送collect_texas_party_prize收取奖励

## 20095 choose one deal

1. login在`['store_info'][u'choose_one_deal]`字段下返回商店数据，在login返回choose_one_deal字段，这个字段下面有purchase_times字段，表示玩家可付费次数，以及disconnection字段，只有购买未收奖才有这个字段，ratio_list字段
2. 活动数据在collect_store协议返回，在choose_one_deal字段下，字段同login
3. 活动奖励需要发送collect_choose_one_deal_prize协议收取，返回值为通用奖励收奖字段和choose_one_deal字段

## MP40

1. 新增mp_last_purchase字段，只有可以买super_bundle的用户才有这个字段，值为2（上赛季购买MP，未购买MPP）和3（上赛季购买bundle，未购买MPP）
2. 新增purchase_flag字段，0是未付费，2是MP解锁，3是bundle解锁，4是super bundle

## 20009

1. login在activity20009字段下返回ratio_list字段，转盘的加成配置
2. 发送new pay协议购买后，返回ratio_idx和ratio_list数据，分别表示转盘结果（从1开始）和转盘配置
3. 发送collect_store收取金币

## lucky 7 bonus

1. 在有小游戏未完成的情况下，login返回lucky7_bonus_normal_status字段或lucky7_bonus_premium_status字段，字段下的数据有theme_respin_list, total_win_list, total_win, center_dice_list, bet, multi
2. 新增collect_lucky7_bonus协议，传入type字段，区分收取的小游戏类型，normal及premium，收取normal小游戏的奖励同时会返回premium的商店信息

## bingo 176

1. treasure_bowl_coins, treasure_bowl_once_coins在login的bingo字段下返回，collect_bingo_ball的bingo字段下也会返回
2. 完成单张卡片时在collect_bingo_ball下返回treasure_bowl_prize字段，返回奖励收取后的返回值

## 21059

1. login新增21059_status返回值，返回pick_collect_list:[0,0,0]
2. 新增collect_sale_pick_coins协议，传入type字段，1-3，返回收奖数据和21059_status字段

## 小游戏中心

1. login返回small_game_center字段，字段下有chips_cost字段和up_to字段
2. 发送consum_chips协议购买小游戏，如['consume_chips', {'type': 'small_game_center','game_name': 'slot_of_cash', 'game_type': 0}]，game_name传小游戏的名字，game_type传购买的类型，购买后的返回值为小游戏的数据和用户剩余第二货币数量

## mow

1. mow_puzzle_pick协议的返回值pick_info字段下的mow_emptye字段替换为mow_box字段，并在返回mow_box字段的同时返回need_chips字段，返回开启礼盒需要的第二货币数量
2. 发送consum_chips协议购买小游戏，如['consume_chips', {'type': 'mow_gift_box'}], 购买成功后返回用户剩余第二货币数据已经prize_config字段（奖励数据）和reward_info字段（收奖返回值）

## 邮票换赛季

1. 

## 常用命令

### 数据库

阿里云sql数据库
host:39.102.117.166
port:13306
name:phoroot
pass:MMb@x&G6qVTaO@u7

阿里云redis数据库
host:39.102.117.166
port:16379
auth:r-2ze0l7ziambsy8nzli:MMb@x&G6qVTaO@u7

```shell
mysql -h cf-proxy.proxy-ctvtvx6kalfh.us-west-2.rds.amazonaws.com -u phoenix -p'rKpVgOxuD1u&*()' -D phoenix
```

```shell
find  -name "*.pyc" | xargs rm -rf
git branch | xargs git branch -D
git branch | grep 'jcr*' | xargs git branch -D
git rev-parse --short HEAD
```



### screen

```shell
# 删除screen
screen -S *** -X quit
# 新建
screen -R ***
# 踢出
screen -Dr ***
```



